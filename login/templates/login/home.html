<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title> YOLO </title>
    {% load staticfiles %}
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript">
          $(document).ready(function() {
	          setTimeout(function(){
	              $('body').addClass('loaded');
	          }, 3000);

	      });
	  </script>

    <link href="{% static 'login/style.css' %}" rel="stylesheet" type="text/css">
  </head> 
  <body>
    <div id = "buttabs">
      <button id = "loginbut" type = "submit"> Login </button>
      <button id = "signupbut" type = "submit"> Submit </button> 
    </div>
    <div id = "info">
      <p id = "instr">Please say the following phrase after clicking the start recording button.</p>
      <p id = "randphrase"> PlaceHolder </p>
      <div id = "recbuts">
        <button id = "startrec" class = "record"> Start Recording </button>
        <button id = "stoprec" class = "stop"> Stop Recording </button> 
      </div>
    </div>
    <div id = "recordings">
      <ol id="recordingsList"></ol>
    </div>
    <script> 

      /*Code for recording from microphone reference: https://addpipe.com/blog/using-recorder-js-to-capture-wav-audio-in-your-html5-web-site/ */

      URL = window.URL || window.webkitURL;

      var gumStream;            
      var rec;              
      var input;            
      var AudioContext = window.AudioContext || window.webkitAudioContext;
      var audioContext 
      var recordButton = document.getElementById("startrec");
      var stopButton = document.getElementById("stoprec");
      recordButton.addEventListener("click", startRecording);
      stopButton.addEventListener("click", stopRecording);
      function startRecording() {
        console.log("recordButton clicked");
        var constraints = { audio: true, video:false }
        recordButton.disabled = true;
        stopButton.disabled = false;
        navigator.mediaDevices.getUserMedia(constraints).then(function(stream) {
          console.log("getUserMedia() success, stream created, initializing Recorder.js ...");
          audioContext = new AudioContext();
          gumStream = stream;
          input = audioContext.createMediaStreamSource(stream);
          rec = new Recorder(input,{numChannels:1})
          rec.record()
          console.log("Recording started");
        }).catch(function(err) {
            recordButton.disabled = false;
            stopButton.disabled = true;
        });
      }

      function stopRecording() {
        console.log("stopButton clicked");
        stopButton.disabled = true;
        recordButton.disabled = false;
        rec.stop();
        gumStream.getAudioTracks()[0].stop();
        rec.exportWAV(createDownloadLink);
      }

      function createDownloadLink(blob) {
        var url = URL.createObjectURL(blob);
        var au = document.createElement('audio');
        var li = document.createElement('li');
        var link = document.createElement('a');
        var filename = new Date().toISOString();
        au.controls = true;
        au.src = url;
        link.href = url;
        link.download = filename+".wav"; 
        link.innerHTML = "Save to disk";
        li.appendChild(au);
        li.appendChild(document.createTextNode(filename+".wav "))
        li.appendChild(link);
        li.appendChild(document.createTextNode (" "))
        recordingsList.appendChild(li);
      }
    </script>
    <script src="https://cdn.rawgit.com/mattdiamond/Recorderjs/08e7abd9/dist/recorder.js"></script> <!-- Matt Damon's recorder.js module-->
  </body>
</html>
